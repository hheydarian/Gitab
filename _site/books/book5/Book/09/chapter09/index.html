<h1>فصل ۹ – مجوزها</h1>
<hr>
<h2>مقدمه</h2>
<p>یکی از پایه‌ای‌ترین تفاوت‌های سیستم‌عامل‌های شبه‌یونیکس با پلتفرم‌های دسکتاپ خانگی، مدل دقیق کنترل دسترسی آن‌ها است.<br>
هر فایل، پوشه و فرایند دارای مالکیت و مجوزهایی است که تعیین می‌کند چه کسانی می‌توانند آن را بخوانند، تغییر دهند یا اجرا کنند.<br>
بدون شناخت این مفاهیم نه‌تنها امکان مدیریت سامانه‌های چندکاربره دشوار می‌شود، بلکه ممکن است ناخواسته به امنیت خود آسیب بزنیم.</p>
<p>در این فصل می‌آموزیم:</p>
<ul>
<li>ساختار مالکیت فایل‌ها در لینوکس چگونه است و چه نقشی برای کاربر و گروه تعریف می‌شود.</li>
<li>مجوزهای خواندن، نوشتن و اجرا چه معنایی دارند و چگونه برای فایل‌ها و دایرکتوری‌ها متفاوت تفسیر می‌شوند.</li>
<li>چگونه با دستور <code>chmod</code>، هم به روش نمادین و هم به روش عددی، مجوزها را تغییر دهیم.</li>
<li>کاربردهای دستورهای <code>chown</code> و <code>chgrp</code> برای تغییر مالک و گروه.</li>
<li>مفهوم <code>umask</code> و تأثیر آن بر مجوزهای پیش‌فرض.</li>
<li>نحوهٔ استفاده از <code>sudo</code> و <code>su</code> برای اجرای دستورات با امتیازات دیگر حساب‌ها.</li>
</ul>
<hr>
<h2>مالکیت فایل‌ها</h2>
<p>هر شیء در سیستم‌فایل دو نوع مالک دارد: «مالک کاربر» و «مالک گروه».<br>
کاربر مالک معمولاً شخصی است که فایل را ایجاد کرده است، در حالی که گروه مالک به مجموعه‌ای از کاربران اشاره دارد که می‌توانند مجوزهای مشترک داشته باشند.</p>
<p>برای مشاهدهٔ مالکیت و مجوزها از <code>ls -l</code> استفاده کنید:</p>
<pre class="hljs"><code><span class="hljs-built_in">ls</span> -l /etc/passwd
</code></pre>
<p>خروجی نمونه:</p>
<pre class="hljs"><code>-rw-r--r-- 1 root root 2761 Jan 13 09:32 /etc/passwd
</code></pre>
<p>ستون چهارم و پنجم نام کاربر و گروه مالک را نشان می‌دهند (در این مثال هر دو <code>root</code>).<br>
اولین مجموعه از کاراکترها (<code>-rw-r--r--</code>) نمایانگر نوع فایل و مجوزها است که در ادامه بررسی می‌کنیم.</p>
<h3>تغییر مالکیت</h3>
<p>فقط کاربر ریشه یا مالک فایل (در برخی شرایط) می‌تواند مالکیت را تغییر دهد.<br>
برای تغییر مالک از <code>chown</code> استفاده می‌کنیم:</p>
<pre class="hljs"><code><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> ali document.txt      <span class="hljs-comment"># انتقال مالکیت فایل به کاربر «ali»</span>
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> ali:<span class="hljs-built_in">users</span> document.txt <span class="hljs-comment"># تغییر مالک کاربر و گروه به‌طور هم‌زمان</span>
</code></pre>
<p>اگر فقط بخواهیم گروه را عوض کنیم، دستور <code>chgrp</code> مناسب است:</p>
<pre class="hljs"><code><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chgrp</span> developers project/
</code></pre>
<p>در مثال بالا، گروه مالک پوشهٔ <code>project/</code> به <code>developers</code> تغییر می‌کند.<br>
به یاد داشته باشید که تغییر مالکیت روی پوشه‌ها می‌تواند دسترسی به محتویات را نیز تحت تأثیر قرار دهد.</p>
<hr>
<h2>مجوزهای دسترسی</h2>
<p>مجوزهای کلاسیک یونیکس سه نوع‌اند: خواندن (<code>r</code>)، نوشتن (<code>w</code>) و اجرا (<code>x</code>).<br>
این مجوزها برای سه دستهٔ کاربر تعیین می‌شوند:</p>
<ol>
<li><strong>مالک (user)</strong></li>
<li><strong>گروه (group)</strong></li>
<li><strong>سایرین (others)</strong></li>
</ol>
<p>در رشتهٔ مجوزها مانند <code>-rwxr-xr--</code>، کاراکتر نخست نوع فایل است (<code>-</code> برای فایل معمولی، <code>d</code> برای دایرکتوری، <code>l</code> برای پیوند نمادین و ...)، سه کاراکتر بعدی مجوزهای مالک، سپس سه کاراکتر بعدی مجوزهای گروه و در نهایت سه کاراکتر پایانی مجوزهای سایر کاربران هستند.</p>
<h3>معنای مجوزها برای فایل‌ها و پوشه‌ها</h3>
<ul>
<li><strong>خواندن (<code>r</code>)</strong>: برای فایل یعنی امکان مشاهدهٔ محتوا. برای دایرکتوری یعنی امکان فهرست کردن نام فایل‌های داخل آن.</li>
<li><strong>نوشتن (<code>w</code>)</strong>: برای فایل یعنی امکان تغییر محتوا یا حذف آن. برای دایرکتوری یعنی توانایی ایجاد، حذف یا تغییر نام آیتم‌های داخل.</li>
<li><strong>اجرا (<code>x</code>)</strong>: برای فایل یعنی می‌توان آن را به عنوان برنامه یا اسکریپت اجرا کرد. برای دایرکتوری یعنی امکان ورود (cd) و دسترسی به آیتم‌ها با مسیر کامل.</li>
</ul>
<p>اگر دایرکتوری مجوز خواندن نداشته باشد اما <code>x</code> داشته باشد، می‌توانیم به فایل‌های آن دسترسی داشته باشیم به شرطی که نام دقیق‌شان را بدانیم.</p>
<h3>بیت‌های ویژه</h3>
<p>علاوه بر <code>rwx</code>، سه پرچم خاص نیز وجود دارد:</p>
<ul>
<li><strong>setuid (<code>s</code> در ستون مالک)</strong>: اگر روی فایل اجرایی تنظیم شود، برنامه با امتیازهای مالک اجرا می‌شود. نمونهٔ مشهور: <code>/usr/bin/passwd</code> که با امتیاز ریشه رمز عبور را تغییر می‌دهد.</li>
<li><strong>setgid (<code>s</code> در ستون گروه)</strong>: برای فایل‌های اجرایی مشابه setuid است اما امتیازهای گروه را به ارث می‌دهد. روی دایرکتوری‌ها باعث می‌شود فایل‌های جدید ساخته‌شده در آن گروه مالک دایرکتوری را بگیرند.</li>
<li><strong>sticky (<code>t</code> در ستون سایرین)</strong>: عموماً روی دایرکتوری‌هایی مانند <code>/tmp</code> قرار دارد و باعث می‌شود کاربران تنها بتوانند فایل‌های خود را حذف کنند، حتی اگر مجوز نوشتن عمومی وجود داشته باشد.</li>
</ul>
<p>برای نمایش عددی این بیت‌ها از یک رقم اضافی در سمت چپ استفاده می‌شود (۰ تا ۷).</p>
<hr>
<h2>تغییر مجوزها با <code>chmod</code></h2>
<p>دستور <code>chmod</code> دو روش اصلی برای تعیین مجوز دارد: نمادین و عددی.</p>
<h3>حالت نمادین</h3>
<p>در این نگارش از حروف <code>u</code>, <code>g</code>, <code>o</code>, <code>a</code> برای اشاره به مالک، گروه، سایرین و همه استفاده می‌شود.<br>
عملگرهای <code>+</code>, <code>-</code>, <code>=</code> نیز برای افزودن، حذف یا تعیین دقیق مجوزها به کار می‌روند.</p>
<p>مثال‌ها:</p>
<pre class="hljs"><code><span class="hljs-built_in">chmod</span> u+x script.sh        <span class="hljs-comment"># افزودن مجوز اجرا برای مالک</span>
<span class="hljs-built_in">chmod</span> go-w report.txt      <span class="hljs-comment"># حذف مجوز نوشتن از گروه و سایرین</span>
<span class="hljs-built_in">chmod</span> a=r file.txt         <span class="hljs-comment"># تنظیم مجوز خواندن برای همه و حذف سایر مجوزها</span>
<span class="hljs-built_in">chmod</span> u+s /usr/local/bin/app  <span class="hljs-comment"># فعال کردن بیت setuid</span>
</code></pre>
<p>می‌توان دستورات را با کاما ترکیب کرد:</p>
<pre class="hljs"><code><span class="hljs-built_in">chmod</span> u=rw,go=r shared.conf
</code></pre>
<h3>حالت عددی</h3>
<p>در روش عددی هر مجموعهٔ مجوز به صورت یک عدد پایهٔ ۸ بیان می‌شود.<br>
ارزش‌های پایه عبارت‌اند از: خواندن = ۴، نوشتن = ۲، اجرا = ۱.</p>
<p>برای نمونه، <code>rwx</code> برابر ۷ (۴+۲+۱)، <code>rw-</code> برابر ۶ (۴+۲)، و <code>r-x</code> برابر ۵ (۴+۱) است.</p>
<p>دستور زیر مجوزهای فایل را به <code>-rwxr-x---</code> تغییر می‌دهد:</p>
<pre class="hljs"><code><span class="hljs-built_in">chmod</span> 750 script.sh
</code></pre>
<p>اگر بخواهیم بیت‌های ویژه را هم تنظیم کنیم، عدد چهارمی در ابتدای توالی اضافه می‌کنیم:</p>
<ul>
<li>۴ برای setuid</li>
<li>۲ برای setgid</li>
<li>۱ برای sticky</li>
</ul>
<p>مثلاً <code>chmod 4755 program</code> بیت setuid را همراه با مجوز <code>755</code> فعال می‌کند.</p>
<hr>
<h2>مجوزهای پیش‌فرض و <code>umask</code></h2>
<p>هنگامی که برنامه‌ای فایل جدیدی می‌سازد، مجوزهای پیش‌فرض بر اساس «ماسک کاربر» یا <code>umask</code> تعیین می‌شود.<br>
<code>umask</code> بیت‌هایی را مشخص می‌کند که باید از مجوزهای پیشنهادی حذف شوند.</p>
<p>برای مشاهدهٔ مقدار فعلی:</p>
<pre class="hljs"><code><span class="hljs-built_in">umask</span>
</code></pre>
<p>به طور معمول مقدار <code>022</code> یا <code>002</code> دیده می‌شود.<br>
سیستم فایل معمولاً فایل‌های جدید را با مجوز پایهٔ <code>666</code> (rw برای همه) و دایرکتوری‌های جدید را با <code>777</code> (rwx برای همه) پیشنهاد می‌دهد.<br>
<code>umask</code> این مقادیر را کاهیده و نتیجهٔ نهایی را تعیین می‌کند.</p>
<p>مثلاً اگر <code>umask</code> برابر <code>022</code> باشد:</p>
<ul>
<li>فایل جدید: 666 - 022 = 644 → <code>rw-r--r--</code></li>
<li>دایرکتوری جدید: 777 - 022 = 755 → <code>rwxr-xr-x</code></li>
</ul>
<p>برای تغییر موقتی <code>umask</code> در نشست فعلی:</p>
<pre class="hljs"><code><span class="hljs-built_in">umask</span> 027
</code></pre>
<p>برای اعمال دائم آن را در فایل پیکربندی شل مانند <code>~/.bashrc</code> یا <code>/etc/profile</code> قرار دهید.</p>
<hr>
<h2>کار با امتیازات ریشه: <code>su</code> و <code>sudo</code></h2>
<p>بسیاری از عملیات مدیریتی نیاز به امتیازهای بالاتر از کاربر معمولی دارند.<br>
در لینوکس دو ابزار اصلی برای این منظور استفاده می‌شود: <code>su</code> و <code>sudo</code>.</p>
<h3><code>su</code></h3>
<p>دستور <code>su</code> (switch user) پوسته‌ای جدید با هویت کاربر دیگر – معمولاً ریشه – باز می‌کند.</p>
<pre class="hljs"><code>su -
</code></pre>
<p>گزینهٔ <code>-</code> باعث می‌شود پوستهٔ جدید محیط ورود کامل کاربر هدف را بارگذاری کند.<br>
برای خروج از نشست <code>su</code> کافی است <code>exit</code> بزنید.</p>
<h3><code>sudo</code></h3>
<p><code>sudo</code> اجازه می‌دهد یک دستور منفرد را با امتیاز کاربر دیگری اجرا کنیم، بدون آن‌که وارد پوستهٔ او شویم.<br>
اغلب سیستم‌ها <code>sudo</code> را برای کاربران مجاز پیکربندی می‌کنند تا پس از وارد کردن رمز عبور خود بتوانند عملیات مدیریتی انجام دهند.</p>
<pre class="hljs"><code><span class="hljs-built_in">sudo</span> apt update
<span class="hljs-built_in">sudo</span> systemctl restart nginx
</code></pre>
<p>قوانین <code>sudo</code> در فایل <code>/etc/sudoers</code> و دایرکتوری <code>/etc/sudoers.d/</code> تعریف می‌شوند و باید فقط با دستور <code>visudo</code> ویرایش شوند تا خطاهای نحوی جلوگیری شود.</p>
<p>برای مشاهدهٔ دستورات مجاز، از <code>sudo -l</code> استفاده کنید.</p>
<h3>بهترین شیوه‌ها</h3>
<ul>
<li>فقط مجوزهای لازم را اعطا کنید و از دادن دسترسی کامل به همه کاربران بپرهیزید.</li>
<li>برای کارهای روزمره از حساب معمولی استفاده کنید و تنها در زمان نیاز از <code>sudo</code> کمک بگیرید.</li>
<li>تاریخچهٔ دستورات اجراشده با <code>sudo</code> در فایل‌های لاگ ذخیره می‌شود که در صورت نیاز برای بررسی امنیتی قابل استفاده است.</li>
</ul>
<hr>
<h2>نمونهٔ عملی: مدیریت پوشهٔ اشتراکی</h2>
<p>فرض کنید باید پوشه‌ای مشترک برای تیم توسعه ایجاد کنیم تا اعضا بتوانند فایل‌های پروژه را تبادل کنند.<br>
می‌خواهیم:</p>
<ol>
<li>گروهی به نام <code>devteam</code> بسازیم.</li>
<li>مالکیت پوشهٔ <code>/srv/devshare</code> را به کاربر مسئول و گروه <code>devteam</code> بدهیم.</li>
<li>تضمین کنیم هر فایل جدیدی که در پوشه ایجاد می‌شود به طور خودکار به گروه <code>devteam</code> تعلق داشته باشد و سایر اعضا بتوانند آن را بخوانند و بنویسند.</li>
</ol>
<p>مراحل:</p>
<pre class="hljs"><code><span class="hljs-built_in">sudo</span> groupadd devteam
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /srv/devshare
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> lead:devteam /srv/devshare
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 2775 /srv/devshare
</code></pre>
<p>مجوز <code>2775</code> چه معنایی دارد؟</p>
<ul>
<li>رقم نخست <code>2</code> بیت setgid را فعال می‌کند تا فایل‌های جدید گروه دایرکتوری را به ارث ببرند.</li>
<li>ارقام بعدی <code>775</code> یعنی مالک (<code>lead</code>) تمام مجوزها را دارد، اعضای گروه <code>devteam</code> نیز مجوز خواندن/نوشتن/اجرا دارند و سایر کاربران فقط می‌توانند بخوانند و وارد دایرکتوری شوند.</li>
</ul>
<p>اگر می‌خواهیم کاربران نتوانند فایل‌های یکدیگر را حذف کنند، می‌توانیم بیت sticky را نیز فعال کنیم:</p>
<pre class="hljs"><code><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 3775 /srv/devshare
</code></pre>
<hr>
<h2>جمع‌بندی</h2>
<p>مدل مجوزهای لینوکس ابزار قدرتمندی برای حفظ امنیت و سازمان‌دهی فایل‌ها است.<br>
با درک مالکیت، بیت‌های ویژه و مجوزهای پیش‌فرض می‌توانیم دسترسی کاربران را دقیقاً مطابق نیاز تنظیم کنیم.<br>
یادگیری استفادهٔ صحیح از <code>sudo</code> و <code>su</code> نیز به ما اجازه می‌دهد کارهای مدیریتی را بدون به خطر انداختن کل سیستم انجام دهیم.</p>
<p>در فصل بعد (فرایندها) خواهیم دید چگونه سیستم یونیکس اجرای برنامه‌ها را مدیریت می‌کند و چگونه کاربران می‌توانند آن‌ها را کنترل کنند.</p>
